# 计算机网络分层处理思想

[toc]

## 源地址处理报文流程

### 应用层

- 浏览器产生报文

![image-20221204172842481](/Users/hhh/Library/Application Support/typora-user-images/image-20221204172842481.png)

### 运输层

- 添加TCP报文段首部，使之成为TCP报文段
  - 该首部的作用主要是区分应用进程以
  - 实现可靠传输 

![image-20221204182230872](/Users/hhh/Library/Application Support/typora-user-images/image-20221204182230872.png)

### 网络层

- 添加IP首部，使之成为IP数据报
  - 主要是使得IP数据报可以在互联网上传输，可以被路由器转发

![](/Users/hhh/Library/Application Support/typora-user-images/image-20221204173013435.png)

### 数据链路层

- 添加首尾部，ETH，称之为帧，主要是为了让一个帧能够在一个链路上或者网络上进行传输，能够被目的网络接受
  - 帧首：标识目的地址与源地址
  - 帧尾：让目的机器检查是否有误码

![image-20221204173327287](/Users/hhh/Library/Application Support/typora-user-images/image-20221204173327287.png)

### 物理层

- 物理层将帧看作是比特流，由于网络N1是以太网，因此物理层会在比特流前 添加前导码
  -  作用是让目的主机做好接受帧的准备

![image-20221204173638760](/Users/hhh/Library/Application Support/typora-user-images/image-20221204173638760.png)



- 物理层将比特流转成相应信号，发送数据到以太网N1【传输媒体，通过网线/WI-FI】

![image-20221204180302039](/Users/hhh/Library/Application Support/typora-user-images/image-20221204180302039.png)

- 到达路由器

![image-20221204173741488](/Users/hhh/Library/Application Support/typora-user-images/image-20221204173741488.png)

## 路由器处理报文

### 物理层

路由器物理层接收到信号，将信号变为比特流，去掉**前导码**后，交给数据链路层，实际上交付给链路层的是帧

![image-20221204174753736](/Users/hhh/Library/Application Support/typora-user-images/image-20221204174753736.png)



### 链路层

数据链路层，获取出**帧**的数据，数据链路层去除帧的首尾部，将其交给网络层

- 实际上交付给网络成的是IP数据报，包含HTTP/TCP/IP数据报

![image-20221204174829008](/Users/hhh/Library/Application Support/typora-user-images/image-20221204174829008.png)

### 网络层

- 网络层解析IP数据报的首部，从中提取出目的网络地址

![image-20221204175255994](/Users/hhh/Library/Application Support/typora-user-images/image-20221204175255994.png)

- 然后查找自身的路由表，确定转发端口，以便进行转发，然后将数据提供给数据链路层

![image-20221204175756971](/Users/hhh/Library/Application Support/typora-user-images/image-20221204175756971.png)



### 数据链路层

数据链路层接受到网络层来的IP数据报信息，会在IP数据报上添加首尾部，使之成为一个帧

![image-20221204175841522](/Users/hhh/Library/Application Support/typora-user-images/image-20221204175841522.png)



### 物理层

物理层收到数据链路层的帧，在其上添加前导码【目的是为了让目标主机做好接收数据的准备】

![image-20221204180003129](/Users/hhh/Library/Application Support/typora-user-images/image-20221204180003129.png)

### 信号通过传输媒体到达WEB服务器

![image-20221204180722845](/Users/hhh/Library/Application Support/typora-user-images/image-20221204180722845.png)

## Web服务器处理过程

### 物理层

物理层接收到信号，将其转换为比特流，去掉前导码后，交给数据链路层

![image-20221204180819649](/Users/hhh/Library/Application Support/typora-user-images/image-20221204180819649.png)

### 数据链路层

物理层交付的是帧，数据链路层会将帧的首尾部去除，将IP数据报交付给网络层

![image-20221204180924108](/Users/hhh/Library/Application Support/typora-user-images/image-20221204180924108.png)



### 网络层

IP数据报，网络层将IP数据报去除，交付TCP报文段给到运输层

![image-20221204181035061](/Users/hhh/Library/Application Support/typora-user-images/image-20221204181035061.png)

### 运输层

运输层将TCP报文段首部去除，将HTTP请求报文交付给应用层

![image-20221204181133953](/Users/hhh/Library/Application Support/typora-user-images/image-20221204181133953.png)

### 应用层

应用层获取到Http请求报文后，对报文进行解析，然后给主机发回http响应报文

![image-20221204181459064](/Users/hhh/Library/Application Support/typora-user-images/image-20221204181459064.png)

## Web服务器响应流程

与之前流程一致，http响应报文需要在web服务器层层封装

- 通过物理层变为响应信号
- 通过传输媒体到达路由器
- 路由器转发报文给主机
- 主机将物理层收到的信号，转换为比特流
- 通过逐层解封，获取http响应报文

![image-20221204181555397](/Users/hhh/Library/Application Support/typora-user-images/image-20221204181555397.png)