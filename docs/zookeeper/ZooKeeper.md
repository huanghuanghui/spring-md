# ZooKeeper

[toc]

## 简介

- 开源的分布式文件存储系统，应用程序协调服务

### 功能

- 分布式同步
- 命名服务
- 集群维护
- 分布式锁

### 作用

简化分布式应用协调及其管理的难度，提供高性能的分布式服务

## 集群角色

| 角色               | 说明                                                         |
| :----------------- | :----------------------------------------------------------- |
| 领导者（Leader）   | 为客户端提供读和写的服务，负责投票的发起和决议，更新系统状态。 |
| 跟随者（Follower） | 为客户端提供读服务，如果是写服务则转发给Leader。在选举过程中参与投票。 |
| 观察者（Observer） | 为客户端提供读服务器，如果是写服务则转发给Leader。不参与选举过程中的投票，也不参与“过半写成功”策略。在不影响写性能的情况下提升集群的读性能。此角色于zookeeper3.3系列新增的角色。 |

## 运行模式

- 单机：开发/测试，对性能/高可用要求不高
- 伪集群：单机部署多个zk只需要配置zoo.cfg文件中的server配置就行了
- 集群：多个zk节点，只需要配置zoo.cfg文件中不同的server配置，一般部署3台，防止脑裂，产生多个主。zk要求半数以上服务正常，部署公式为2n+1
  - 高性能
  - 高可靠性
  - 有序访问

```properties
server.1=192.168.5.129:2888:3888
server.2=192.168.5.130:2888:3888
server.3=192.168.5.131:2888:3888

n：代表的是一个数字，表示这个服务器的标号
127.0.0.1：IP服务器地址
2888：ZooKeeper服务器之间的通信端口
3888：Leader选举的端口
```

## 投票

1，2，3

- 1启动，投自己一票，没有其他机器，1就只有1票
- 2启动，投自己一票，收到1的投票，2票，票数最高，判断是否超过半数节点，无，2不为主
- 3启动，投自己一票，收到1，2的投票，3票，票数最高，判断是否超过半数节点，是，3为主

